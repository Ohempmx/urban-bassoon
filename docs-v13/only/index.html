<!doctype html>
<title>
  
    Filtering Tests&#58; Only | Node Tap
  
</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
html {
  display: block;
  font-family: sans-serif;
  padding: 0 1em;
  margin: 0 auto;
  border-top: 10px solid #f7df1e;
  line-height:1.5;
  color:#333;
  position:relative;
}

html::before {
  width:100%;
  display:block;
  position:fixed;
  top:0;
  left:0;
  height:10px;
  background:#f7df1e;
  content: " ";
}

body {
  padding:0;
  margin: 0;
}

a:hover, a:active, a:focus {
  color: red;
}

code, pre, kbd {
  font-size: 100%;
  font-family: Triplicate T4, Fira Mono OT, Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

section.side {
  display: block;
  padding:0;
  min-height:100px;
  margin: 0;
  width:100%;
}

.side h2, .side p {
  margin-top: 0;
}

section.side li {
  display: inline;
}

section.side ul {
  display: block;
  overflow:auto;
}

section.side li ul {
  display: inline;
}

.side ul {
  padding:0;
  margin:0 ;
}

.side img {
  display: block;
  margin-right: 1em;
  margin-top: 1em;
}

section.main {
  display: block;
  padding-top:20px;
}

@media only screen and (min-width: 240px) {
  .side img {
    float:left;
    margin: 0 1em 0 0;
  }
}

@media only screen and (min-width: 800px) {
  html {
    width:600px;
    padding:0 0 0 200px;
  }
  section.side {
    width: 180px;
    position: fixed;
    overflow:auto;
    max-height:100%;
    margin: 0 0 0 -200px;
  }
  .side img {
    display: block;
    float:none;
  }

  section.side ul {
    overflow: none;
    display: block;
  }

  section.side li {
    display: block;
  }

  section.side a {
    display: block;
  }

  section.side li ul {
    margin: 0;
    display: block;
  }

  section.side li li {
    margin-left: 1em;
  }

  .side h2, .side p {
    margin-top: 1em;
  }

  section.main {
    float: right;
    width: 600px;
    padding-bottom: 100px;
  }
}
</style>
<link href="../static/prism.css" rel="stylesheet">

<body>

<section class='side'>
  <h2><a href="../index.html"><img src='../static/tapjs.png' width=100 height=100 alt='Test Anything JS'></a></h2>
  <p>A Test-Anything-Protocol library for Node.js</p>
  <ul>
  
    <li>
      <a href="../index.html">Index</a>
      
    </li>
  
    <li>
      <a href="../basics/index.html">Getting Started</a>
      
    </li>
  
    <li>
      <a href="../using-with/index.html">Using tap with...</a>
      
    </li>
  
    <li>
      <a href="../configuring/index.html">Configuring tap</a>
      
    </li>
  
    <li>
      <a href="../api/index.html">API</a>
      
      <ul>
        
        <li><a href="../asserts/index.html">Asserts</a></li>
        
        <li><a href="../promises/index.html">Promises</a></li>
        
        <li><a href="../subtests/index.html">Subtests</a></li>
        
        <li><a href="../parallel/index.html">Parallel Tests</a></li>
        
        <li><a href="../snapshots/index.html">Snapshot Testing</a></li>
        
        <li><a href="../test-lifecycle">Test Lifecycle Events</a></li>
        
        <li><a href="../grep/index.html">Filtering Tests: grep</a></li>
        
        <li><a href="index.html">Filtering Tests: only</a></li>
        
        <li><a href="../mochalike/index.html">Mocha-like DSL</a></li>
        
        <li><a href="../advanced/index.html">Advanced</a></li>
        
      </ul>
      
    </li>
  
    <li>
      <a href="../cli/index.html">CLI</a>
      
    </li>
  
    <li>
      <a href="../coverage/index.html">Coverage</a>
      
    </li>
  
    <li>
      <a href="../coverage-map/index.html">Coverage Map</a>
      
    </li>
  
    <li>
      <a href="../save-failures-run-changed/index.html">Saving, Running Changed</a>
      
    </li>
  
    <li>
      <a href="../watch/index.html">Watching Files for Changes</a>
      
    </li>
  
    <li>
      <a href="../reporting/index.html">Reporting</a>
      
    </li>
  
    <li>
      <a href="../tap-format.1">The TAP Protocol</a>
      
    </li>
  
    <li>
      <a href="../tap-files/index.html">Working with TAP files</a>
      
    </li>
  
    <li>
      <a href="../changelog/index.html">Change Log</a>
      
    </li>
  
    <li>
      <a href="https://github.com/tapjs/node-tap">GitHub Repo</a>
      
    </li>
  
  </ul>
  <pre><a href="http://npm.im/tap">npm install tap</a>
<a href="../cli/index.html">tap test/*.js</a></pre>
</section>
<section class='main'>
<h1 id="filtering-tests-with-only-option">Filtering Tests with Only Option</h1>

<p>Child tests can be filtered by setting the <code class="highlighter-rouge">only</code> flag in the options
object, or by using the <code class="highlighter-rouge">t.only</code> method.</p>

<p>Because tests are run top-to-bottom synchronously, there’s no way to
know at the start of a test file if a <code class="highlighter-rouge">t.only()</code> call is coming.  To
activate this filtering, use the <code class="highlighter-rouge">--only</code> flag to the tap
<a href="../cli/index.html">command-line interface</a>, or set <code class="highlighter-rouge">TAP_ONLY=1</code> in the
environment, or set the <code class="highlighter-rouge">t.runOnly = true</code> in a test file.</p>

<p>Setting the <code class="highlighter-rouge">TAP_ONLY=1</code> environment variable or using <code class="highlighter-rouge">tap --only</code>
will restrict the root tap object from running tests that aren’t
flagged as “only”.  To filter deeper in a test suite, set
<code class="highlighter-rouge">t.runOnly = true</code> at the appropriate level.</p>

<p>Note: this is for filtering test functions within a test file.  If you
want to run only one <em>file</em>, just pass the appropriate argument to the
<code class="highlighter-rouge">tap</code> executable.  That is, instead of <code class="highlighter-rouge">tap test/*.js</code>, do <code class="highlighter-rouge">tap
test/foo.js</code> to just run a single file.</p>

<p>Also, this only filters <em>subtests</em>.  Individual assertions will always
be emitted if they are encountered.</p>

<h2 id="example">Example</h2>

<p>Consider this test file:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'tap'</span><span class="p">)</span>

<span class="nx">t</span><span class="p">.</span><span class="nx">only</span><span class="p">(</span><span class="s1">'only run this test'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// all tests in here will be run</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'this is fine'</span><span class="p">)</span>

  <span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'first child'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'got here'</span><span class="p">)</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'second child'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'got here, too'</span><span class="p">)</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="nx">t</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'a second top level test'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'second top level test assertion'</span><span class="p">)</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">})</span>
</code></pre></div></div>

<p>If run with <code class="highlighter-rouge">node mytest.js</code>, it’ll produce this output:</p>

<div class="language-tap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">TAP version 13
</span><span class="c"># "only run this test" has `only` set but all tests run
# Subtest: only run this test
</span>    ok 1 - this is fine
    # Subtest: first child
        ok 1 - got here
        1..1
    ok 2 - first child # time=2.352ms

    # Subtest: second child
        ok 1 - got here, too
        1..1
    ok 3 - second child # time=0.48ms

    1..3
<span class="kr">ok</span> <span class="mi">1</span> - only run this test <span class="c"># time=11.58ms
</span>
<span class="c"># Subtest: a second top level test
</span>    ok 1 - second top level test assertion
    1..1
<span class="kr">ok</span> <span class="mi">2</span> - a second top level test <span class="c"># time=0.337ms
</span>
<span class="kd">1..2</span><span class="c">
# time=26.044ms
</span></code></pre></div></div>

<p>If run with <code class="highlighter-rouge">TAP_ONLY=1 node mytest.js</code>, then we see this instead:</p>

<div class="language-tap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">TAP version 13
</span><span class="c"># Subtest: only run this test
</span>    ok 1 - this is fine
    # Subtest: first child
        ok 1 - got here
        1..1
    ok 2 - first child # time=3.062ms

    # Subtest: second child
        ok 1 - got here, too
        1..1
    ok 3 - second child # time=0.577ms

    1..3
<span class="kr">ok</span> <span class="mi">1</span> - only run this test <span class="c"># time=15.972ms
</span>
<span class="kr">ok</span> <span class="mi">2</span> - a second top level test <span class="c"># </span><span class="cp">SKIP</span><span class="c"> filter: only
</span><span class="kd">1..2</span><span class="c">
# skip: 1
# time=24.457ms
</span></code></pre></div></div>

<p>Note that the second test was skipped.</p>

<p>To only show the first child in the first test block, we could do
this:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../tap'</span><span class="p">)</span>

<span class="nx">t</span><span class="p">.</span><span class="nx">only</span><span class="p">(</span><span class="s1">'only run this test'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// only run tests here with t.only()</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">runOnly</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'this is fine'</span><span class="p">)</span>

  <span class="nx">t</span><span class="p">.</span><span class="nx">only</span><span class="p">(</span><span class="s1">'first child'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'got here'</span><span class="p">)</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'second child'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'got here, too'</span><span class="p">)</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="nx">t</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'a second top level test'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'second top level test assertion'</span><span class="p">)</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Now when we run the test, we see this:</p>

<div class="language-tap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">TAP version 13
</span><span class="c"># Subtest: only run this test
</span>    ok 1 - this is fine
    # Subtest: first child
        ok 1 - got here
        1..1
    ok 2 - first child # time=1.609ms

    ok 3 - second child # SKIP filter: only
    1..3
    # skip: 1
<span class="kr">ok</span> <span class="mi">1</span> - only run this test <span class="c"># time=8.585ms
</span>
<span class="kr">ok</span> <span class="mi">2</span> - a second top level test <span class="c"># </span><span class="cp">SKIP</span><span class="c"> filter: only
</span><span class="kd">1..2</span><span class="c">
# skip: 1
# time=14.176ms
</span></code></pre></div></div>

<p>Note that the second child test was skipped along with the second top
level test.</p>

<p>To get the same results with the tap command line, you can do this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ tap --only mytest.js
mytest.js ............................................. 2/4
  Skipped: 2

total ................................................. 2/4

  2 passing (277.134ms)
  2 pending
</code></pre></div></div>

<p>Using the <code class="highlighter-rouge">spec</code> reporter will show more detail about the tests being
skipped and run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ tap --only mytest.js -Rspec

mytest.js
  only run this test
    ✓ this is fine
    first child
      ✓ got here
    - second child

  - a second top level test

  2 passing (231.681ms)
  2 pending
</code></pre></div></div>

</section>
<script src="../static/prism.js"></script>
</body>
