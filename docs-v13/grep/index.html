<!doctype html>
<title>
  
    Filtering Tests&#58; Grep | Node Tap
  
</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
html {
  display: block;
  font-family: sans-serif;
  padding: 0 1em;
  margin: 0 auto;
  border-top: 10px solid #f7df1e;
  line-height:1.5;
  color:#333;
  position:relative;
}

html::before {
  width:100%;
  display:block;
  position:fixed;
  top:0;
  left:0;
  height:10px;
  background:#f7df1e;
  content: " ";
}

body {
  padding:0;
  margin: 0;
}

a:hover, a:active, a:focus {
  color: red;
}

code, pre, kbd {
  font-size: 100%;
  font-family: Triplicate T4, Fira Mono OT, Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

section.side {
  display: block;
  padding:0;
  min-height:100px;
  margin: 0;
  width:100%;
}

.side h2, .side p {
  margin-top: 0;
}

section.side li {
  display: inline;
}

section.side ul {
  display: block;
  overflow:auto;
}

section.side li ul {
  display: inline;
}

.side ul {
  padding:0;
  margin:0 ;
}

.side img {
  display: block;
  margin-right: 1em;
  margin-top: 1em;
}

section.main {
  display: block;
  padding-top:20px;
}

@media only screen and (min-width: 240px) {
  .side img {
    float:left;
    margin: 0 1em 0 0;
  }
}

@media only screen and (min-width: 800px) {
  html {
    width:600px;
    padding:0 0 0 200px;
  }
  section.side {
    width: 180px;
    position: fixed;
    overflow:auto;
    max-height:100%;
    margin: 0 0 0 -200px;
  }
  .side img {
    display: block;
    float:none;
  }

  section.side ul {
    overflow: none;
    display: block;
  }

  section.side li {
    display: block;
  }

  section.side a {
    display: block;
  }

  section.side li ul {
    margin: 0;
    display: block;
  }

  section.side li li {
    margin-left: 1em;
  }

  .side h2, .side p {
    margin-top: 1em;
  }

  section.main {
    float: right;
    width: 600px;
    padding-bottom: 100px;
  }
}
</style>
<link href="../static/prism.css" rel="stylesheet">

<body>

<section class='side'>
  <h2><a href="../index.html"><img src='../static/tapjs.png' width=100 height=100 alt='Test Anything JS'></a></h2>
  <p>A Test-Anything-Protocol library for Node.js</p>
  <ul>
  
    <li>
      <a href="../index.html">Index</a>
      
    </li>
  
    <li>
      <a href="../basics/index.html">Getting Started</a>
      
    </li>
  
    <li>
      <a href="../using-with/index.html">Using tap with...</a>
      
    </li>
  
    <li>
      <a href="../configuring/index.html">Configuring tap</a>
      
    </li>
  
    <li>
      <a href="../api/index.html">API</a>
      
      <ul>
        
        <li><a href="../asserts/index.html">Asserts</a></li>
        
        <li><a href="../promises/index.html">Promises</a></li>
        
        <li><a href="../subtests/index.html">Subtests</a></li>
        
        <li><a href="../parallel/index.html">Parallel Tests</a></li>
        
        <li><a href="../snapshots/index.html">Snapshot Testing</a></li>
        
        <li><a href="../test-lifecycle">Test Lifecycle Events</a></li>
        
        <li><a href="index.html">Filtering Tests: grep</a></li>
        
        <li><a href="../only/index.html">Filtering Tests: only</a></li>
        
        <li><a href="../mochalike/index.html">Mocha-like DSL</a></li>
        
        <li><a href="../advanced/index.html">Advanced</a></li>
        
      </ul>
      
    </li>
  
    <li>
      <a href="../cli/index.html">CLI</a>
      
    </li>
  
    <li>
      <a href="../coverage/index.html">Coverage</a>
      
    </li>
  
    <li>
      <a href="../coverage-map/index.html">Coverage Map</a>
      
    </li>
  
    <li>
      <a href="../save-failures-run-changed/index.html">Saving, Running Changed</a>
      
    </li>
  
    <li>
      <a href="../watch/index.html">Watching Files for Changes</a>
      
    </li>
  
    <li>
      <a href="../reporting/index.html">Reporting</a>
      
    </li>
  
    <li>
      <a href="../tap-format.1">The TAP Protocol</a>
      
    </li>
  
    <li>
      <a href="../tap-files/index.html">Working with TAP files</a>
      
    </li>
  
    <li>
      <a href="../changelog/index.html">Change Log</a>
      
    </li>
  
    <li>
      <a href="https://github.com/tapjs/node-tap">GitHub Repo</a>
      
    </li>
  
  </ul>
  <pre><a href="http://npm.im/tap">npm install tap</a>
<a href="../cli/index.html">tap test/*.js</a></pre>
</section>
<section class='main'>
<h1 id="filtering-tests-with-grep-options">Filtering Tests with Grep Options</h1>

<p>Child tests can be filtered using regular expressions with the <code class="highlighter-rouge">grep</code>
option.</p>

<p>Note: this is for filtering test functions within a test file.  If you
want to filter which <em>files</em> get run, just pass the appropriate
argument to the <code class="highlighter-rouge">tap</code> executable.  That is, instead of <code class="highlighter-rouge">tap
test/*.js</code>, do <code class="highlighter-rouge">tap test/foo.js</code> to just run a single file.</p>

<h2 id="command-line-usage">Command Line Usage</h2>

<p>On the <a href="../cli/index.html">command-line</a>, specify one or more patterns with
<code class="highlighter-rouge">--grep=&lt;pattern&gt;</code> (or <code class="highlighter-rouge">-g&lt;pattern&gt;</code> for short).</p>

<p>You can provide multiple patterns by providing multiple <code class="highlighter-rouge">--grep</code>
options.  The first pattern will filter tests at the top level of your
test files.  The next pattern will filter child tests of that test,
and so on.</p>

<p>Patterns can be either a simple string, or a JavaScript RegExp literal
like <code class="highlighter-rouge">/[asdf]/i</code>.  Use the RegExp literal format if you need to use
regular expression flags such as <code class="highlighter-rouge">i</code> for case insensitive matching.</p>

<p>To invert the matches (that is, run all tests that <em>don’t</em> match), use
the <code class="highlighter-rouge">--invert</code> or <code class="highlighter-rouge">-i</code> flag.</p>

<p>For example, consider this test file:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// mytest.js</span>
<span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'tap'</span><span class="p">)</span>

<span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'first'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'apple'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'apples are tasty'</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'banana'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'bananas are yellow'</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>

<span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'second'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'this is fine'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'i think'</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'i am ok with how things are proceeding'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'therefor I am'</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>

<p>To only run the first test branch, you could do this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tap --grep=first mytest.js
</code></pre></div></div>

<p>Using the default classic reporter, we see this output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ tap --grep=first mytest.js
mytest.js ............................................. 2/3
  Skipped: 1

total ................................................. 2/3

  2 passing (230.078ms)
  1 pending
</code></pre></div></div>

<p>Looking at the underlying TAP output by specifying the <code class="highlighter-rouge">tap</code> reporter,
here’s what’s being generated:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tap --grep=first mytest.js -Rtap
</code></pre></div></div>

<div class="language-tap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">TAP version 13
</span><span class="c"># Subtest: mytest.js
</span>    # Subtest: first
        # Subtest: apple
            ok 1 - apples are tasty
            1..1
        ok 1 - apple # time=8.892ms

        # Subtest: banana
            ok 1 - bananas are yellow
            1..1
        ok 2 - banana # time=1.297ms

        1..2
    ok 1 - first # time=18.544ms

    ok 2 - second # SKIP filter: /first/
    1..2
    # skip: 1
    # time=28.242ms
<span class="kr">ok</span> <span class="mi">1</span> - mytest.js <span class="c"># time=300.676ms
</span>
<span class="kd">1..1</span><span class="c">
# time=320.615ms
</span></code></pre></div></div>

<p>We can get more granular by specifying multiple greps.  Let’s say that
we want to run all second-level tests with a <code class="highlighter-rouge">p</code> or <code class="highlighter-rouge">P</code> in the name.
Here’s how to do that:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#      +-- first grep, allow anything matching .
#      |
#      |   +-- second grep, filter matching /p/, case-insensitive
#      |   |
#      v   v
$ tap -g. -g/p/i mytest.js -Rtap
</code></pre></div></div>

<p>Result:</p>

<div class="language-tap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">TAP version 13
</span><span class="c"># Subtest: mytest.js
</span>    # Subtest: first
        # Subtest: apple
            ok 1 - apples are tasty
            1..1
        ok 1 - apple # time=7.449ms

        ok 2 - banana # SKIP filter: /p/
        1..2
        # skip: 1
    ok 1 - first # time=16.035ms

    # Subtest: second
        ok 1 - this is fine # SKIP filter: /p/
        # Subtest: i am ok with how things are proceeding
            ok 1 - therefor I am
            1..1
        ok 2 - i am ok with how things are proceeding # time=0.982ms

        1..2
        # skip: 1
    ok 2 - second # time=4.339ms

    1..2
    # time=28.875ms
<span class="kr">ok</span> <span class="mi">1</span> - mytest.js <span class="c"># time=255.454ms
</span>
<span class="kd">1..1</span><span class="c">
# time=267.758ms
</span></code></pre></div></div>

<h2 id="api-programmatic-usage">API Programmatic Usage</h2>

<p>While it’s rare, you can also specify greps programmatically within
tests, either in child tests or at the top level, by providing an
array of regular expressions.</p>

<p>Just like on the command line, the first pattern is matched against
the first level of child tests, and so on through subsequent levels.
When all the patterns are exhausted, the entire test is run.</p>

<p>The array of regular expressions can be specified on the <code class="highlighter-rouge">t</code> object,
or in the <code class="highlighter-rouge">options</code> object passed to the <code class="highlighter-rouge">t.test()</code> method.</p>

<p>For example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// mytest.js</span>
<span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'tap'</span><span class="p">)</span>

<span class="c1">// set on a test object directly, after creation</span>
<span class="nx">t</span><span class="p">.</span><span class="nx">grep</span> <span class="o">=</span> <span class="p">[</span><span class="sr">/./</span><span class="p">,</span> <span class="sr">/p/i</span><span class="p">]</span>

<span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'first'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'apple'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'apples are tasty'</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'banana'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'bananas are yellow'</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>

<span class="c1">// new greps override what's inherited from the parent</span>
<span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'second'</span><span class="p">,</span> <span class="p">{</span> <span class="na">grep</span><span class="p">:</span> <span class="p">[</span> <span class="sr">/fi</span><span class="se">[</span><span class="sr">ln</span><span class="se">]</span><span class="sr">e/</span> <span class="p">]</span> <span class="p">},</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'this is fine'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'i think'</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="nx">t</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">'i am ok with how things are proceeding'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">t</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">pass</span><span class="p">(</span><span class="s1">'therefor I am'</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Output:</p>

<div class="language-tap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">TAP version 13
</span><span class="c"># Subtest: first
</span>    # Subtest: apple
        ok 1 - apples are tasty
        1..1
    ok 1 - apple # time=5.166ms

    ok 2 - banana # SKIP filter: /p/i
    1..2
    # skip: 1
<span class="kr">ok</span> <span class="mi">1</span> - first <span class="c"># time=11.805ms
</span>
<span class="c"># Subtest: second
</span>    # Subtest: this is fine
        ok 1 - i think
        1..1
    ok 1 - this is fine # time=0.86ms

    ok 2 - i am ok with how things are proceeding # SKIP filter: /fi[ln]e/
    1..2
    # skip: 1
<span class="kr">ok</span> <span class="mi">2</span> - second <span class="c"># time=3.277ms
</span>
<span class="kd">1..2</span><span class="c">
# time=21.632ms
</span></code></pre></div></div>

<h2 id="setting-in-the-environment">Setting in the Environment</h2>

<p>To set greps on the root level test object, you can set the <code class="highlighter-rouge">TAP_GREP</code>
and <code class="highlighter-rouge">TAP_GREP_INVERT</code> environment variables.</p>

<p><code class="highlighter-rouge">TAP_GREP</code> is a <code class="highlighter-rouge">\n</code>-delimited list of patterns.</p>

<p><code class="highlighter-rouge">TAP_GREP_INVERT</code> can be set to <code class="highlighter-rouge">'1'</code> to invert the meaning of grep
matches.</p>

<p>For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ TAP_GREP=$'first\napple' node mytest.js
</code></pre></div></div>

<p>Output:</p>

<div class="language-tap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">TAP version 13
</span><span class="c"># Subtest: first
</span>    # Subtest: apple
        ok 1 - apples are tasty
        1..1
    ok 1 - apple # time=4.35ms

    ok 2 - banana # SKIP filter: /apple/
    1..2
    # skip: 1
<span class="kr">ok</span> <span class="mi">1</span> - first <span class="c"># time=10.378ms
</span>
<span class="kr">ok</span> <span class="mi">2</span> - second <span class="c"># </span><span class="cp">SKIP</span><span class="c"> filter: /first/
</span><span class="kd">1..2</span><span class="c">
# skip: 1
# time=15.818ms
</span></code></pre></div></div>

<p>To invert the matches:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ TAP_GREP_INVERT=1 TAP_GREP=$'first\nfine' node mytest.js | pbcopy
</code></pre></div></div>

<div class="language-tap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">TAP version 13
</span><span class="kr">ok</span> <span class="mi">1</span> - first <span class="c"># </span><span class="cp">SKIP</span><span class="c"> filter out: /first/
# Subtest: second
</span>    ok 1 - this is fine # SKIP filter out: /fine/
    # Subtest: i am ok with how things are proceeding
        ok 1 - therefor I am
        1..1
    ok 2 - i am ok with how things are proceeding # time=3.117ms

    1..2
    # skip: 1
<span class="kr">ok</span> <span class="mi">2</span> - second <span class="c"># time=9.441ms
</span>
<span class="kd">1..2</span><span class="c">
# skip: 1
# time=21.761ms
</span></code></pre></div></div>

</section>
<script src="../static/prism.js"></script>
</body>
